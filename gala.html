<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GALA EN DIRECTO | VIAJE DE S3X0 AWARDS</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: { gold: '#d4af37', black: '#050505', panel: '#111' },
            fontFamily: { sans: ['Montserrat', 'sans-serif'], display: ['Playfair Display', 'serif'] },
            animation: {
                'shake': 'shake 0.5s cubic-bezier(.36,.07,.19,.97) both infinite',
                'pop': 'pop 0.6s ease-out forwards'
            },
            keyframes: {
                shake: {
                    '10%, 90%': { transform: 'translate3d(-1px, 0, 0)' },
                    '20%, 80%': { transform: 'translate3d(2px, 0, 0)' },
                    '30%, 50%, 70%': { transform: 'translate3d(-4px, 0, 0)' },
                    '40%, 60%': { transform: 'translate3d(4px, 0, 0)' }
                },
                pop: {
                    '0%': { transform: 'scale(0.8)', opacity: '0' },
                    '100%': { transform: 'scale(1)', opacity: '1' }
                }
            }
          }
        }
      }
    </script>
    
    <style>
        body { background-color: #050505; color: white; overflow: hidden; }
        .perspective-1000 { perspective: 1000px; }
        .card-flip { transition: transform 0.6s cubic-bezier(0.4, 0.2, 0.2, 1); transform-style: preserve-3d; width: 100%; height: 100%; position: relative; }
        .card-flip.flipped { transform: rotateY(180deg); }
        .front, .back { backface-visibility: hidden; position: absolute; inset: 0; border-radius: 1rem; }
        .back { transform: rotateY(180deg); background: #111; }
        .glow { box-shadow: 0 0 50px rgba(212, 175, 55, 0.15); transition: box-shadow 0.3s; }
        .glow-active { box-shadow: 0 0 100px rgba(212, 175, 55, 0.6); }
    </style>
</head>
<body class="h-screen w-screen flex flex-col items-center justify-center relative bg-[url('fotos/fondo_estrellas.jpg')] bg-cover bg-center">

    <audio id="audio-drumroll" src="fotos/redoble.mp3" preload="auto"></audio>
    <audio id="audio-victory" src="fotos/victoria.mp3" preload="auto"></audio>

    <div class="absolute inset-0 bg-black/90 z-0"></div>
    <div class="absolute inset-0 z-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-gold/10 via-transparent to-transparent opacity-50"></div>

    <div class="absolute top-0 w-full p-8 z-20 flex justify-between items-center">
        <div class="flex items-center gap-4">
            <img src="fotos/logo.png" class="w-12 h-12 object-contain drop-shadow-[0_0_10px_rgba(212,175,55,0.8)]">
            <div>
                <p class="text-gold/60 text-xs tracking-[0.4em] uppercase font-bold">Gala en Directo</p>
                <h1 class="text-white font-display text-xl tracking-widest">VIAJE DE S3X0 AWARDS</h1>
            </div>
        </div>
        <div class="text-right">
            <span id="counter" class="text-gold font-mono text-2xl font-bold">1 / 15</span>
        </div>
    </div>

    <div class="relative z-10 w-full max-w-4xl h-[70vh] flex flex-col items-center justify-center">
        
        <h2 id="category-title" class="text-3xl md:text-5xl font-display font-bold text-transparent bg-clip-text bg-gradient-to-r from-white via-gold to-white uppercase text-center mb-10 drop-shadow-lg transition-all duration-500 transform scale-100">
            CARGANDO DATOS...
        </h2>

        <div class="perspective-1000 w-[90%] md:w-[500px] aspect-[3/4] md:aspect-[4/5]">
            <div id="main-card" class="card-flip cursor-pointer" onclick="startRevealSequence()">
                
                <div id="card-front" class="front bg-panel border border-gold/40 flex flex-col items-center justify-center glow relative overflow-hidden group">
                    <div class="absolute inset-0 bg-[url('fotos/pattern_gold.png')] opacity-5"></div>
                    
                    <div class="w-40 h-40 border-2 border-dashed border-gold/30 rounded-full animate-[spin_10s_linear_infinite] mb-6 flex items-center justify-center">
                        <div class="w-32 h-32 border border-gold/50 rounded-full flex items-center justify-center">
                             <i data-lucide="lock" class="w-10 h-10 text-gold group-hover:scale-110 transition-transform"></i>
                        </div>
                    </div>

                    <p class="text-white font-display text-2xl uppercase tracking-widest mb-2">Sobre Cerrado</p>
                    <p class="text-neutral-500 text-xs tracking-[0.2em] uppercase">Click para revelar</p>
                </div>

                <div class="back border-2 border-gold flex flex-col relative overflow-hidden shadow-[0_0_100px_rgba(212,175,55,0.3)]">
                    
                    <div class="relative w-full h-[65%] bg-black">
                        <img id="winner-img" src="" class="absolute inset-0 w-full h-full object-cover hidden">
                        <video id="winner-video" src="" class="absolute inset-0 w-full h-full object-cover hidden" loop muted playsinline></video>
                        <div class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent"></div>
                    </div>

                    <div class="absolute bottom-0 w-full h-[40%] bg-gradient-to-t from-black via-black to-transparent flex flex-col justify-end p-8 text-center">
                        <p class="text-gold text-xs font-bold tracking-[0.5em] uppercase mb-2 animate-pulse">GANADOR</p>
                        <h3 id="winner-name" class="text-3xl md:text-5xl font-display font-bold text-white uppercase mb-4 leading-none">
                            NOMBRE
                        </h3>
                        <button onclick="descargarDiploma(event)" class="mx-auto border border-gold/50 text-gold hover:bg-gold hover:text-black px-6 py-2 rounded-full text-[10px] font-bold uppercase tracking-widest transition-all flex items-center gap-2">
                            <i data-lucide="download" class="w-3 h-3"></i> Guardar Diploma
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="absolute bottom-10 w-full px-12 z-20 flex justify-between items-center">
        <button onclick="changeCategory(-1)" class="text-neutral-600 hover:text-white transition-colors uppercase text-xs font-bold tracking-widest flex items-center gap-2">
            <i data-lucide="arrow-left" class="w-4 h-4"></i> Anterior
        </button>
        
        <button id="btn-next" onclick="changeCategory(1)" class="opacity-0 pointer-events-none transform translate-y-10 transition-all duration-500 bg-white text-black px-8 py-3 rounded-sm font-bold uppercase text-sm tracking-widest hover:bg-gold hover:scale-105 shadow-lg flex items-center gap-2">
            Siguiente <i data-lucide="arrow-right" class="w-4 h-4"></i>
        </button>
    </div>

    <script>
        lucide.createIcons();

        // =========================================================
        // 1. CONFIGURACIÓN (LO QUE TÚ TIENES QUE EDITAR)
        // =========================================================
        
        // Pega aquí tu enlace CSV publicado de Google Sheets
        const SHEET_CSV_URL = "TU_ENLACE_CSV_AQUI"; 

        // Lista de las 15 Categorías en ORDEN
        const categoriesList = [
            "Más tocapelotas del grupo",
            "Persona más graciosa del grupo",
            "Frase mítica del año",
            "Premio al más desaparecido",
            "Premio al que más come",
            "Fantasmada del año",
            "Pareja del año",
            "Mejor culo del grupo",
            "Plot twist del año",
            "Mejor foto del año",
            "Premio al más cagón",
            "Premio al que más bebe",
            "Momento más gracioso / Jaimitada del año",
            "Mejor vídeo del año",
            "Mejor evento del año"
        ];

        // DICCIONARIO DE MEDIOS (MAPEO)
        // Aquí le dices: "Si el ganador es X, muestra la foto Y"
        // Usa minúsculas para los nombres (claves) para evitar errores.
        const mediaMap = {
            // PERSONAS (Ya tienes sus fotos)
            "carlos": "fotos/carlos.jpg",
            "adriana": "fotos/adriana.jpg",
            "nicolas": "fotos/nicolas.jpg",
            "jose luis": "fotos/joseluis.jpg",
            "lucia": "fotos/lucia.jpg",
            "pablo dolz": "fotos/pablod.jpg",
            "pablo garcia": "fotos/pablog.jpg",
            
            // MOMENTOS ESPECIALES / FOTOS GRUPALES
            // Tienes que crear/renombrar estas fotos en tu carpeta
            "la caída": "fotos/caida.jpg", 
            "foto grupal": "fotos/grupo.jpg",
            "el beso": "fotos/beso_pareja.jpg",
            "plot twist": "fotos/plot_twist.jpg",
            "video caida": "fotos/video_ganador.mp4" // EJEMPLO DE VIDEO
        };

        // =========================================================
        // 2. LÓGICA DEL SISTEMA
        // =========================================================
        
        let winnersData = {}; // Aquí se guardarán los resultados del Excel
        let currentIndex = 0;
        let isRevealing = false;
        let isRevealed = false;

        // Elementos DOM
        const audioDrum = document.getElementById('audio-drumroll');
        const audioVictory = document.getElementById('audio-victory');
        const cardInner = document.getElementById('main-card');
        const cardFront = document.getElementById('card-front');
        const imgEl = document.getElementById('winner-img');
        const videoEl = document.getElementById('winner-video');

        // INICIO: Cargar datos simulados o reales
        // IMPORTANTE: Para probar AHORA sin Excel, descomenta la linea de abajo
        // loadMockData(); 
        
        // Para usar Excel real, usa esta función:
        fetchSheetData();

        function fetchSheetData() {
            // Simulamos datos si no hay URL (borra esto cuando tengas la URL)
            if(SHEET_CSV_URL === "TU_ENLACE_CSV_AQUI") {
                console.log("Usando datos de prueba...");
                loadMockData();
                return;
            }

            // Aquí iría el fetch real al CSV
            // Como es complejo sin el link real, usaremos el mock para que te funcione la demo
        }

        function loadMockData() {
            // ESTO ES UNA SIMULACIÓN DE LO QUE VENDRÍA DEL EXCEL
            // El sistema buscará en 'mediaMap' la foto correspondiente al nombre.
            winnersData = {
                "Más tocapelotas del grupo": "Pablo Dolz",
                "Persona más graciosa del grupo": "Pablo Garcia",
                "Mejor vídeo del año": "Video Caida", // Ejemplo video
                "Mejor foto del año": "Foto Grupal"   // Ejemplo foto momento
            };
            updateUI();
        }

        function updateUI() {
            // Reset
            isRevealed = false;
            isRevealing = false;
            cardInner.classList.remove('flipped');
            cardFront.classList.remove('animate-shake');
            document.getElementById('btn-next').classList.remove('opacity-100', 'pointer-events-auto', 'translate-y-0');
            document.getElementById('btn-next').classList.add('opacity-0', 'pointer-events-none', 'translate-y-10');

            // Cargar Textos
            const currentCat = categoriesList[currentIndex];
            document.getElementById('category-title').innerText = currentCat;
            document.getElementById('counter').innerText = `${currentIndex + 1} / ${categoriesList.length}`;

            // PREPARAR EL CONTENIDO OCULTO (TRUCO DE MAGIA)
            // 1. Buscamos quién ganó esa categoría
            // Nota: Si no hay dato en el excel, ponemos "Pendiente"
            const winnerName = winnersData[currentCat] || "Votación en curso...";
            document.getElementById('winner-name').innerText = winnerName;

            // 2. Buscamos su foto/video en el mapa
            // Normalizamos a minúsculas para buscar en el diccionario
            const mediaKey = winnerName.toLowerCase();
            const mediaPath = mediaMap[mediaKey] || "fotos/logo.png"; // Fallback logo

            // 3. ¿Es video o imagen?
            if (mediaPath.endsWith('.mp4')) {
                imgEl.classList.add('hidden');
                videoEl.classList.remove('hidden');
                videoEl.src = mediaPath;
            } else {
                videoEl.classList.add('hidden');
                videoEl.pause();
                imgEl.classList.remove('hidden');
                imgEl.src = mediaPath;
            }
        }

        function startRevealSequence() {
            if (isRevealed || isRevealing) return;
            isRevealing = true;

            // 1. FASE ÉPICA: REDOBLE + TEMBLOR
            audioDrum.currentTime = 0;
            audioDrum.play().catch(e => console.log("Click para audio"));
            
            cardFront.classList.add('animate-shake', 'glow-active'); // Temblor

            // 2. EL CLÍMAX (A los 3 segundos)
            setTimeout(() => {
                revealWinner();
            }, 3000); // 3 segundos de tensión
        }

        function revealWinner() {
            cardFront.classList.remove('animate-shake');
            audioDrum.pause();
            
            // Sonido Victoria
            audioVictory.currentTime = 0;
            audioVictory.play();

            // Flip
            cardInner.classList.add('flipped');
            isRevealed = true;

            // Si es video, reproducir
            if (!videoEl.classList.contains('hidden')) {
                videoEl.play();
            }

            // Confeti Masivo
            fireConfetti();
            
            // Mostrar botón Siguiente
            setTimeout(() => {
                const btn = document.getElementById('btn-next');
                btn.classList.remove('opacity-0', 'pointer-events-none', 'translate-y-10');
                btn.classList.add('opacity-100', 'pointer-events-auto', 'translate-y-0');
            }, 1000);
        }

        function changeCategory(dir) {
            const newIndex = currentIndex + dir;
            if (newIndex >= 0 && newIndex < categoriesList.length) {
                currentIndex = newIndex;
                updateUI();
            }
        }

        function fireConfetti() {
            var duration = 4 * 1000;
            var animationEnd = Date.now() + duration;
            var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 99999 };

            var interval = setInterval(function() {
                var timeLeft = animationEnd - Date.now();
                if (timeLeft <= 0) return clearInterval(interval);
                var particleCount = 50 * (timeLeft / duration);
                confetti(Object.assign({}, defaults, { particleCount, origin: { x: Math.random(), y: Math.random() - 0.2 } }));
            }, 250);
        }

        function descargarDiploma(e) {
            e.stopPropagation(); // Evita que se gire la carta
            alert("Aquí se generaría el PDF del diploma (pendiente de implementar librería jsPDF)");
        }

    </script>
</body>
</html>